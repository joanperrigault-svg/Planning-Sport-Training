<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Planning sport ‚Äì Ao√ªt ‚Üí Octobre 2025</title>
<style>
  :root{
    --c1:#90CAF9; --c2:#81C784; --c3:#FFF176; --c4:#FFB74D; --c5:#EF9A9A;
    --ink:#0d1b2a; --ink2:#394867; --brand:#0D47A1; --line:#e5e9ef; --panel:#f7f9fb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--panel);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;display:flex;justify-content:space-between;align-items:center;gap:12px}
  .title{font-weight:800;color:var(--brand);font-size:18px}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{background:#e8f0fe;color:var(--brand);padding:6px 10px;border-radius:999px;font-size:12px}
  main{max-width:1100px;margin:0 auto;padding:12px}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px;margin:12px 0}
  .card h3{margin:0 0 8px;color:var(--brand);font-size:16px}
  .kv{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:#eef3fd;color:var(--brand);padding:4px 8px;border-radius:10px;font-size:12px}
  .obj{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .obj .tile{border:1px solid var(--line);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:6px}
  .obj .big{font-size:22px;font-weight:800;color:var(--brand)}
  .obj .sub{font-size:12px;color:var(--ink2)}
  .week{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:6px}
  .week .day{border:1px solid var(--line);border-radius:10px;padding:6px}
  .week .dname{font-size:12px;color:var(--ink2)}
  .week .dval{font-size:13px;font-weight:700}
  section.month{background:#fff;border:1px solid var(--line);border-radius:12px;margin:12px 0;padding:10px}
  .month h2{margin:4px 6px 12px;color:var(--brand)}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .cell{min-height:92px;border-radius:10px;background:#fff;box-shadow:0 0 0 1px rgba(13,71,161,.06) inset;padding:8px;position:relative}
  .head{background:var(--brand);color:#fff;text-align:center;font-weight:700;position:sticky;top:52px;z-index:5}
  .empty{background:transparent;box-shadow:none}
  .date{font-weight:700;font-size:12px;color:var(--brand)}
  .pill{position:absolute;right:6px;top:6px;font-size:10px;background:#fff8;border:1px solid #0001;border-radius:6px;padding:2px 5px}
  .line{font-size:12px;line-height:1.25;margin-top:4px}
  .detail{font-size:11px;color:var(--ink2)}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .sw{display:flex;align-items:center;gap:6px;font-size:12px}
  .dot{width:12px;height:12px;border-radius:3px;box-shadow:0 0 0 1px #0002 inset}
  .prog svg{width:100%;height:auto;display:block}
  .note{font-size:12px;color:var(--ink2)}
  @media (max-width:640px){
    .obj{grid-template-columns:1fr}
    .cell{min-height:88px}
  }
</style>
</head>
<body>
<header>
  <div class="title">Planning sport ‚Äì Ao√ªt ‚Üí Octobre 2025</div>
  <div class="badges"><div class="badge">üèÉ‚Äç‚ôÇÔ∏è Running</div><div class="badge">üö¥‚Äç‚ôÇÔ∏è V√©lo</div></div>
</header>

<main>
  <!-- OBJECTIFS DU JOUR -->
  <section class="card" id="goals">
    <h3>Objectifs du jour</h3>
    <div class="obj">
      <div class="tile"><div class="sub">Bouger</div><div class="big" id="gMove">‚Äî kcal</div><div class="sub" id="gMoveSrc"></div></div>
      <div class="tile"><div class="sub">M‚Äôentra√Æner</div><div class="big" id="gEx">‚Äî min</div><div class="sub" id="gExSrc"></div></div>
      <div class="tile"><div class="sub">Se lever</div><div class="big" id="gStand">12 h</div><div class="sub">Par d√©faut</div></div>
    </div>
    <div class="note" style="margin-top:8px">R√®gles : course 80 kcal/km ‚Ä¢ v√©lo cadence 24 kcal/km ‚Ä¢ v√©lo force 26 kcal/km ‚Ä¢ renfo 5 kcal/min ‚Ä¢ repos 320 kcal. (Affinables selon tes mesures)</div>
  </section>

  <!-- OBJECTIFS DE LA SEMAINE -->
  <section class="card">
    <h3>Objectifs de la semaine (lun ‚Üí dim)</h3>
    <div class="week" id="weekGoals"></div>
  </section>

  <!-- Derni√®re s√©ance -->
  <section class="card" id="last">
    <h3>Derni√®re s√©ance</h3>
    <div class="kv" id="lastkv"></div>
    <p class="note" id="lastnote"></p>
  </section>

  <!-- L√©gende -->
  <section class="card">
    <h3>L√©gende intensit√©</h3>
    <div class="legend">
      <div class="sw"><span class="dot" style="background:var(--c1)"></span> 1 tr√®s facile (repos)</div>
      <div class="sw"><span class="dot" style="background:var(--c2)"></span> 2 facile</div>
      <div class="sw"><span class="dot" style="background:var(--c3)"></span> 3 mod√©r√©</div>
      <div class="sw"><span class="dot" style="background:var(--c4)"></span> 4 soutenu</div>
      <div class="sw"><span class="dot" style="background:var(--c5)"></span> 5 tr√®s dur</div>
    </div>
  </section>

  <!-- Mois rendus ici -->
  <div id="months"></div>

  <!-- Progression -->
  <section class="card prog">
    <h3>Progression 5 km ‚Äì Ao√ªt 2025</h3>
    <div id="chart"></div>
    <p class="note">34‚Äô45 ‚Üí 27‚Äô45 ‚Üí 26‚Äô37  (‚Äì8‚Äô08 en 17 jours, plus bas = mieux)</p>
  </section>
</main>

<script>
/* ========= Donn√©es ========= */

// Historique r√©el ‚Äì AO√õT (corrig√© 28/08)
const history = {
  "2025-08-14":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 5,20 km", det:"34‚Äô45 ‚Äì 6‚Äô57/km", inten:3, kind:"run", km:5.20}],
  "2025-08-15":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 6,46 km", det:"", inten:3, kind:"run", km:6.46}],
  "2025-08-16":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 6,46 km", det:"", inten:3, kind:"run", km:6.46}],
  "2025-08-17":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 6,33 km", det:"", inten:3, kind:"run", km:6.33}],
  "2025-08-19":[{txt:"üö¥‚Äç‚ôÇÔ∏è 37,50 km", det:"", inten:3, kind:"bike_cadence", km:37.5},
                {txt:"üö¥‚Äç‚ôÇÔ∏è 7,58 km",  det:"", inten:2, kind:"bike_cadence", km:7.58}],
  "2025-08-21":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 10,09 km", det:"", inten:3, kind:"run", km:10.09}],
  "2025-08-22":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 5,01 km",  det:"", inten:3, kind:"run", km:5.01}],
  "2025-08-25":[{txt:"üö¥‚Äç‚ôÇÔ∏è 11,01 km", det:"", inten:2, kind:"bike_cadence", km:11.01}],
  "2025-08-27":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 5 km",      det:"27‚Äô45 ‚Äì 5‚Äô33/km", inten:4, kind:"run", km:5}],
  "2025-08-28":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 11,03 km",  det:"1h14 ‚Äì 6‚Äô43/km",  inten:3, kind:"run", km:11.03}],  /* corrig√© */
  "2025-08-29":[{txt:"üö¥‚Äç‚ôÇÔ∏è 29,24 km", det:"", inten:3, kind:"bike_cadence", km:29.24}],
  "2025-08-30":[{txt:"üö¥‚Äç‚ôÇÔ∏è 12 km",     det:"tranquille", inten:2, kind:"bike_cadence", km:12}],
  "2025-08-31":[{txt:"üèÉ‚Äç‚ôÇÔ∏è Test 5 km", det:"26‚Äô37 ‚Äì 5‚Äô18/km ‚Äì FCmoy 170", inten:5, kind:"run", km:5}],
  // SEPTEMBRE (ajouts)
  "2025-09-03":[{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo force 19,06 km", det:"59‚Äô26 ‚Äì 19,2 km/h ‚Äì FC 139", inten:4, kind:"bike_force", km:19.06, min:59}],
  /* Fusion du 04/09 (deux enregistrements ‚Üí une s√©ance) */
  "2025-09-04":[{txt:"üèÉ‚Äç‚ôÇÔ∏è 8,99 km", det:"57‚Äô25 ‚Äì 6‚Äô23/km ‚Äì FCmoy 154 (1re: 31‚Äô08 √† 151 bpm ‚Ä¢ 2e: 26‚Äô17 √† 158 bpm)", inten:3, kind:"run", km:8.99, min:57}],
  /* Renforcement pr√©vu demain (gainage, fentes, etc.) */
  "2025-09-05":[{txt:"üí™ Renforcement", det:"30‚Äì40‚Äô (gainage, fentes, squats, ponts)", inten:3, kind:"strength", min:35}]
};

// Derni√®re s√©ance (corrig√©e : Z4 surtout sur la 2e partie)
const last = {
  date:"2025-09-04",
  chips:[
    "üèÉ‚Äç‚ôÇÔ∏è Endurance soutenue",
    "üìè 8,99 km ‚Äì 57‚Äô25 ‚Äì 6‚Äô23/km",
    "‚ù§Ô∏è FCmoy 154 bpm (1re: 151 ‚Ä¢ 2e: 158, Z4 surtout 2e partie)"
  ],
  note:"Bonne s√©ance ‚Äòsteady‚Äô. Comme l‚Äôintensit√© a mont√© sur la 2e moiti√©, on programme renforcement l√©ger demain pour bien encaisser."
};

// R√®gles par d√©faut (si rien d‚Äôautre ce jour)
const defaults = {
  1:{txt:"üßò Repos", det:"", inten:1, kind:"rest"},                    // Lundi
  3:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo force", det:"1h15‚Äì1h30", inten:4, kind:"bike_force", min:75, km:25},
  5:{txt:"üí™ Renfo / üö¥‚Äç‚ôÇÔ∏è Cadence", det:"30‚Äì60 min", inten:3, kind:"strength_or_cadence", min:40, km:15}
};

// Plan SEPTEMBRE (par occurrence du jour dans le mois)
const planSept = {
  Tue: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© court", det:"10√ó45‚Äô‚Äô / r√©cup 1‚Äô15‚Äì1‚Äô30", inten:4, kind:"run_frac", min:45, km:7.5},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© long",  det:"6√ó2‚Äô @5‚Äô30/km / r√©cup 1‚Äô30", inten:4, kind:"run_frac", min:48, km:8},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© court", det:"12√ó45‚Äô‚Äô / r√©cup 1‚Äô15", inten:4, kind:"run_frac", min:47, km:7.8},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© long",  det:"8√ó2‚Äô @5‚Äô25/km / r√©cup 1‚Äô30", inten:4, kind:"run_frac", min:50, km:8.2},
    5:{txt:"üèÉ‚Äç‚ôÇÔ∏è Frac. court (aff√ªtage)", det:"8√ó45‚Äô‚Äô / r√©cup 1‚Äô15", inten:4, kind:"run_frac", min:35, km:6}
  },
  Thu: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"45‚Äô @6‚Äô30/km", inten:2, kind:"run", min:45, pace:"6:30"},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"50‚Äô @6‚Äô25/km", inten:2, kind:"run", min:50, pace:"6:25"},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"50‚Äô @6‚Äô20/km", inten:2, kind:"run", min:50, pace:"6:20"},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"40‚Äô facile", inten:2, kind:"run", min:40, pace:"6:30"},
    5:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"35‚Äô tr√®s facile", inten:1, kind:"run", min:35, pace:"6:45"}
  },
  Sat: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"10 km dont 2√ó10‚Äô @6‚Äô00/km", inten:3, kind:"run", km:10},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"12 km dont 3√ó10‚Äô @6‚Äô00/km", inten:3, kind:"run", km:12},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"14 km dont 3√ó12‚Äô @5‚Äô55/km", inten:3, kind:"run", km:14},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Test 5 km", det:"√† bloc", inten:5, kind:"run", km:5}
  },
  Sun: {
    1:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"36 km @18 km/h", inten:3, kind:"bike_cadence", km:36},
    2:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"40 km @18,5 km/h", inten:3, kind:"bike_cadence", km:40},
    3:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"50 km @19 km/h", inten:3, kind:"bike_cadence", km:50},
    4:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"30 km facile", inten:2, kind:"bike_cadence", km:30}
  }
};

// Plan OCTOBRE
const planOct = {
  Tue: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© court", det:"10√ó1‚Äô / r√©cup 1‚Äô15", inten:4, kind:"run_frac", min:48, km:8},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© long",  det:"6√ó3‚Äô @5‚Äô20/km / r√©cup 2‚Äô", inten:4, kind:"run_frac", min:54, km:9},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© court", det:"12√ó1‚Äô / r√©cup 1‚Äô15", inten:4, kind:"run_frac", min:50, km:8.5},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Fractionn√© long",  det:"8√ó2‚Äô30‚Äô‚Äô @5‚Äô15/km / r√©cup 1‚Äô30", inten:4, kind:"run_frac", min:52, km:8.5}
  },
  Thu: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"50‚Äô @6‚Äô15/km", inten:2, kind:"run", min:50, pace:"6:15"},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"55‚Äô @6‚Äô10/km", inten:2, kind:"run", min:55, pace:"6:10"},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"55‚Äô @6‚Äô05/km", inten:2, kind:"run", min:55, pace:"6:05"},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Footing", det:"40‚Äô facile", inten:2, kind:"run", min:40, pace:"6:30"}
  },
  Sat: {
    1:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"12 km dont 3√ó12‚Äô @5‚Äô50/km", inten:3, kind:"run", km:12},
    2:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"14 km dont 3√ó15‚Äô @5‚Äô45/km", inten:3, kind:"run", km:14},
    3:{txt:"üèÉ‚Äç‚ôÇÔ∏è Long run", det:"15 km dont 3√ó15‚Äô @5‚Äô40/km", inten:3, kind:"run", km:15},
    4:{txt:"üèÉ‚Äç‚ôÇÔ∏è Test 10 km", det:"objectif prudent 56‚Äì55‚Äô", inten:5, kind:"run", km:10}
  },
  Sun: {
    1:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"42 km @19,5 km/h", inten:3, kind:"bike_cadence", km:42},
    2:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"48 km @20 km/h", inten:3, kind:"bike_cadence", km:48},
    3:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"50 km @21 km/h", inten:3, kind:"bike_cadence", km:50},
    4:{txt:"üö¥‚Äç‚ôÇÔ∏è V√©lo", det:"35 km souple", inten:2, kind:"bike_cadence", km:35}
  }
};

// S√©rie progression 5 km (temps en minutes d√©cimales)
const progression = [
  {d:"2025-08-14", min:34+45/60},
  {d:"2025-08-27", min:27+45/60},
  {d:"2025-08-31", min:26+37/60},
];

/* ========= Utilitaires ========= */
const WN = ["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"]; // JS 0=Dim
const colorByInt = i => ({1:"var(--c1)",2:"var(--c2)",3:"var(--c3)",4:"var(--c4)",5:"var(--c5)"}[i]||"#fff");
const ymd = (y,m,d)=>`${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
const addDays = (d,n)=>{const x=new Date(d); x.setDate(x.getDate()+n); return x;};
function monthGrid(year,month){
  const first = new Date(year, month-1, 1);
  const start = addDays(first, (first.getDay()+6)%7 * -1); // lundi de la 1√®re ligne
  const days = [];
  for(let i=0;i<42;i++){ const d = addDays(start,i); days.push({date:d, inMonth:(d.getMonth()+1)===month}); }
  return days;
}
function planFor(y, m, d, planMonth){
  const dt = new Date(y, m-1, d); const wd = dt.getDay();
  const name = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][wd];
  if(!planMonth) return null;
  // occurrence du m√™me weekday dans le mois
  let occ=0; for(let i=1;i<=d;i++){ const t=new Date(y,m-1,i); if(t.getDay()===wd) occ++; }
  const table = planMonth[name]; return table && table[occ] ? table[occ] : null;
}

/* ========= Rendu des mois ========= */
function renderMonth(container, year, month, planMonth, withDefaults=true){
  const title = new Date(year,month-1,1).toLocaleDateString("fr-FR",{month:"long",year:"numeric"});
  const sec = document.createElement("section"); sec.className="month";
  sec.innerHTML = `<h2>${title.charAt(0).toUpperCase()+title.slice(1)}</h2>`;
  const grid = document.createElement("div"); grid.className="grid";
  ["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"].forEach(h=>{
    const hd=document.createElement("div"); hd.className="cell head"; hd.textContent=h; grid.appendChild(hd);
  });

  const days = monthGrid(year,month);
  for(const obj of days){
    const d = obj.date, y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate(), key=ymd(y,m,day);
    const cell = document.createElement("div");
    if(!obj.inMonth){ cell.className="cell empty"; grid.appendChild(cell); continue; }
    cell.className="cell";

    // priorit√©: historique > plan > d√©fauts
    let entries = history[key] ? JSON.parse(JSON.stringify(history[key])) : [];
    let inten = entries.reduce((a,b)=>Math.max(a,b.inten),1);

    if(entries.length===0){
      const p = planFor(y,m,day,planMonth);
      if(p){ entries.push(p); inten=Math.max(inten,p.inten); }
      else if(withDefaults){
        const wd = (d.getDay()+6)%7 + 1; // 1..7 (1=Lun)
        if(defaults[wd]){ entries.push(defaults[wd]); inten=Math.max(inten,defaults[wd].inten); }
      }
    }

    cell.style.background = colorByInt(inten);
    cell.innerHTML = `<div class="date">${day}/${month}</div>` +
      entries.map(e=>`<div class="line">${e.txt}${e.det?`<br><span class="detail">${e.det}</span>`:""}</div>`).join("");
    if(history[key]) cell.insertAdjacentHTML("beforeend",`<div class="pill">‚úÖ r√©el</div>`);
    grid.appendChild(cell);
  }
  // petite l√©gende en bas
  const leg = document.createElement("div"); leg.className="legend";
  leg.innerHTML = `
    <div class="sw"><span class="dot" style="background:var(--c2)"></span> facile</div>
    <div class="sw"><span class="dot" style="background:var(--c3)"></span> mod√©r√©</div>
    <div class="sw"><span class="dot" style="background:var(--c4)"></span> soutenu</div>
    <div class="sw"><span class="dot" style="background:var(--c5)"></span> tr√®s dur</div>`;
  sec.appendChild(grid); sec.appendChild(leg); container.appendChild(sec);
}

/* ========= Progression (plus bas = mieux) ========= */
(function(){
  const el = document.getElementById("chart");
  const xs = progression.map(p=>new Date(p.d).getTime());
  const ys = progression.map(p=>p.min);
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys)-0.3, maxY=Math.max(...ys)+0.3;
  const W=320,H=160,P=20, sx=x=>P+(x-minX)/(maxX-minX||1)*(W-2*P), sy=y=>P+(y-minY)/(maxY-minY||1)*(H-2*P);
  const pts = progression.map(p=>`${sx(new Date(p.d).getTime()).toFixed(1)},${sy(p.min).toFixed(1)}`).join(" ");
  const dots = progression.map(p=>`<circle cx="${sx(new Date(p.d).getTime()).toFixed(1)}" cy="${sy(p.min).toFixed(1)}" r="3"/>`).join("");
  const labels = progression.map(p=>{
    const mm = Math.floor(p.min), ss = Math.round((p.min-mm)*60).toString().padStart(2,"0");
    return `<text x="${sx(new Date(p.d).getTime()).toFixed(1)}" y="${(sy(p.min)-8).toFixed(1)}" font-size="10" text-anchor="middle">${mm}:${ss}</text>`;
  }).join("");
  el.innerHTML = `
    <svg viewBox="0 0 ${W} ${H}">
      <rect x="0" y="0" width="${W}" height="${H}" fill="#fff" stroke="${getComputedStyle(document.body).getPropertyValue('--line')||'#e5e9ef'}"/>
      ${[0,1,2,3,4].map(i=>`<line x1="${P}" y1="${P+i*(H-2*P)/4}" x2="${W-P}" y2="${P+i*(H-2*P)/4}" stroke="#eef3fd"/>`).join("")}
      <polyline points="${pts}" fill="none" stroke="${getComputedStyle(document.body).getPropertyValue('--brand')||'#0D47A1'}" stroke-width="2"/>
      ${dots}${labels}
    </svg>`;
})();

/* ========= Objectifs (calcul) ========= */
function paceStrToMinPerKm(str){ if(!str) return null; const [m,s]=str.split(":").map(x=>parseInt(x,10)||0); return m + s/60; }
function estimateFromEntry(e){
  const RUN_KCAL_PER_KM=80, BIKE_CAD=24, BIKE_FORCE=26, STRENGTH_PER_MIN=5, REST_KCAL=320;
  if(e.kind==="run" || e.kind==="run_frac"){
    let km = e.km;
    if(!km && e.min && e.pace){ km = e.min / paceStrToMinPerKm(e.pace); }
    if(!km && e.min){ km = e.min / 6.4; }
    const min = e.min || Math.round((km||7.5)*6.3);
    const kcal = Math.round((km||7.5)*RUN_KCAL_PER_KM);
    return {kcal, min};
  }
  if(e.kind==="bike_cadence"){
    const km = e.km || 36; const kcal = Math.round(km*BIKE_CAD), min = e.min || Math.round(km/19*60);
    return {kcal, min};
  }
  if(e.kind==="bike_force"){
    const km = e.km || 25; const kcal = Math.round(km*BIKE_FORCE), min = e.min || 75;
    return {kcal, min};
  }
  if(e.kind==="strength_or_cadence"){
    const min = e.min || 40; const km = e.km || 15;
    const kcal = Math.max(min*STRENGTH_PER_MIN, Math.round(km*BIKE_CAD));
    return {kcal, min};
  }
  if(e.kind==="strength"){
    const min = e.min || 35; const kcal = min*STRENGTH_PER_MIN;
    return {kcal, min};
  }
  if(e.kind==="rest"){ return {kcal:REST_KCAL, min:0}; }
  return {kcal:320, min:0};
}
function mergeDayTargets(entries){
  return entries.map(estimateFromEntry).reduce((a,b)=>({kcal:a.kcal+b.kcal,min:a.min+b.min}),{kcal:0,min:0});
}
function getPlanMonth(y,m){ if(m===9) return planSept; if(m===10) return planOct; return null; }
function computeTargetsFor(dateObj){
  const y=dateObj.getFullYear(), m=dateObj.getMonth()+1, d=dateObj.getDate(), key=ymd(y,m,d);
  if(history[key]) return {src:"Calcul√© sur s√©ance r√©elle/programm√©e", ...mergeDayTargets(history[key])};
  const p = planFor(y,m,d,getPlanMonth(y,m));
  if(p) return {src:"Bas√© sur le plan", ...mergeDayTargets([p])};
  const wd=(dateObj.getDay()+6)%7+1; if(defaults[wd]) return {src:"Bas√© sur jour par d√©faut", ...mergeDayTargets([defaults[wd]])};
  return {src:"Repos", kcal:320, min:0};
}
function renderDayGoals(elMove,elEx,elStand,elSrc, dateObj){
  const t=computeTargetsFor(dateObj);
  elMove.textContent = `${t.kcal} kcal`;
  elEx.textContent   = `${t.min} min`;
  elStand.textContent= `12 h`;
  elSrc.textContent  = t.src;
}
(function renderTodayGoals(){
  const today = new Date(); // date locale
  renderDayGoals(
    document.getElementById("gMove"),
    document.getElementById("gEx"),
    document.getElementById("gStand"),
    document.getElementById("gMoveSrc"),
    today
  );
})();
(function renderWeekGoals(){
  const mount=document.getElementById("weekGoals");
  const today=new Date(); const dow=(today.getDay()+6)%7; const monday=addDays(today,-dow);
  for(let i=0;i<7;i++){
    const d=addDays(monday,i);
    const t=computeTargetsFor(d);
    const div=document.createElement("div"); div.className="day";
    div.innerHTML = `<div class="dname">${["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"][i]} ${String(d.getDate()).padStart(2,"0")}/${d.getMonth()+1}</div>
                     <div class="dval">${t.kcal} kcal ‚Ä¢ ${t.min} min</div>
                     <div class="note" style="margin-top:2px">${t.src}</div>`;
    mount.appendChild(div);
  }
})();

/* ========= Carte derni√®re s√©ance ========= */
(function(){
  const kv=document.getElementById("lastkv");
  kv.innerHTML = [`üìÖ ${last.date}`].concat(last.chips).map(t=>`<span class="chip">${t}</span>`).join("");
  document.getElementById("lastnote").textContent = last.note;
})();

/* ========= Rendu des mois ========= */
(function(){
  const mount = document.getElementById("months");
  renderMonth(mount,2025,8,null,false);      // Ao√ªt = historique uniquement
  renderMonth(mount,2025,9,planSept,true);   // Septembre = plan + d√©fauts + historique
  renderMonth(mount,2025,10,planOct,true);   // Octobre  = plan + d√©fauts
})();
</script>
</body>
</html>
